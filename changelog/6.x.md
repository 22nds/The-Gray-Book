# vvvv gamma 6.0
TBA

## Breaking Changes
- Due to update to the ImGui.Net 1.90 `ChildWindow`'s "AlwaysUseWindowPadding" flag is moved from the `Flags` into the `Child Flags`. 

## New
- Update to .NET 8.0
- Ships with support for [OSCQuery](https://github.com/Vidvox/OSCQueryProposal) via the VL.OSCQuery package
- Added new [Debug Views](https://thegraybook.vvvv.org/reference/hde/debugging.html): Build Result, App Health and Log
- Added Log node to conveniently log to the new log window
- Adds command line option `--log` to enable logging to file (`%UserProfile%\Documents\vvvv\gamma\vvvv.log`)
- Added Support for [Configuration](https://learn.microsoft.com/en-us/dotnet/core/extensions/configuration)
- Patch Explorer and Document Menu now colored red in case of errors
- Font Size of the Extensions is defined in Settings
- `Exit` (CoreLib.Windows) and `OtherInstancesRunning` (CoreLib) nodes
- `ScopedValues` region with its `R (Scoped)` and `R (Scoped Anonymous)` for sending/receiving data inside (scoped by) the region
- Predefined `DefaultDarkTheme` and `DefaultLightTheme` based on `ColorTheme` allow setting up color palettes
- ImGui
  - `DefaultStyle` node for a convenient predefined style
- Skia
  - LottiePlayer: added `Version`, `Original Size` and `Actual Bounds` output pins.
- Introduces central `AppHost` class. It gives access to various services as well as allows to register new ones (service registry).
- Adds VL.IO.Redis
- Adds VL.TPL.Dataflow, combined with new `MainLoopTaskScheduler` in `AppHost` one can build pipelines which render on the main thread while read/writing data in background threads.
- Unifies keyboard shortcut handling across patch editor, extensions and renderers
  - All render windows will invoke global commands from the patch editor (quad menu). User can opt out of this with existing "Enabled Shortcuts" pin.
  - All render windows now take an optional `ICommandList`. Any commands defined there will take precedence over system commands.
  - Command lists can be created with the new `VL.Core.Commands` package

## Fixes
- IOBoxes now handle display of NULL correctly
- Configuring Int2/3/4 IOBoxes now also has option to set Minimum, Maximum,..
- ImagePlayer (Skia/Stride) now always have files in correct order
- ImGui: 
  - `TableGetColumnFlags`'s 'Index' input pin fixed
  - `NGon` offset fixed when drawing with the `AtCursor` DrawList style
  - `SetIndent` is using hectopixel
- Fixes export issue when using C# project further down in the document hierachy
- Fixes null pointer when clicking on frame border - [forum](https://discourse.vvvv.org/t/exception-when-resizing-a-frame/21562)
- Fixes passing of arrays via link into custom regions - [forum](https://discourse.vvvv.org/t/error-when-interating-over-some-types-in-vl-imgui/21680)
- Couple of fixes in regards to dynamic enums - [forum](https://discourse.vvvv.org/t/changing-the-value-of-a-custom-dynamicenum-from-an-input-pin-seems-to-have-no-effect/21677/3), [forum](https://discourse.vvvv.org/t/custom-enum-dropdowns-stay-red-after-entries-are-created/21536/4)
- Fixes memory leaks when rendering Skia into Stride - [forum](https://discourse.vvvv.org/t/skiarenderer-leaking-into-vram/21684)
- Initialize user fields only with VL defaults if the Create operation does indeed make use of the `This` node. Fixes memory allocations the user wasn't aware of.
- Protection against recursive `CreateDefault` call stacks is now done at runtime. When creating the default value we will now place the instance being created in a thread static field. Should we now again run into the same method that stored instance will be returned. This ensures that any CreateDefault cycles get closed properly. Fixes [full crash](https://discourse.vvvv.org/t/connecting-a-this-node-to-a-channel-node-crashes-vvvv/21744) when connecting `This` to `Changed` node.
- Fixes regression introduced with 5.0 that packages like `Stride.Graphics` could get referenced without being installed in the packages folder - [forum](https://discourse.vvvv.org/t/referencing-stride-graphics-does-not-give-access-to-nodes/21678)
- Fixes auto download of vvvv in `VL.TestEnvironment`
- Fixes regression introduced with 5.0 that Create operations wouldn't show their category in the UI
- Fixes crash in [single-file exported apps](https://learn.microsoft.com/en-us/dotnet/core/deploying/single-file/overview?tabs=cli)
- `SingleInstance` is now thread safe
- Fixes editor crash after deleting a class used by a stateful region - [forum](https://discourse.vvvv.org/t/deleting-a-class-part-of-an-interface-leaves-patch-in-unrecoverable-state/21904)
- Fixes error propagation in patches - [forum](https://discourse.vvvv.org/t/error-reporting-in-the-patch-editor-doesnt-refresh-properly/21936/2), [forum](https://discourse.vvvv.org/t/errors-stay-there-even-when-fixed/21442)
- `SKImage` tooltip (and IO boxes for that matter) will no longer display if triggered from a background thread to avoid complete vvvv crash - [forum](https://discourse.vvvv.org/t/crash-with-images-skimages-on-different-threads/21615)
- Fixes wrong assembly getting loaded when a package was both present in user folder as well as in internal packs/dependencies folder
- Fixes IO box of type `Spread<Spread<Char>>` crashing
- Fixes handling of parameters which actually use `null` as their default. For example when calling a method defined as `Foo(string? s = null)` our system will now correctly pass `null` and not the empty string.
- `AsyncLoop` installs a frame clock now. Fixes animation nodes not returning meaningful results when used inside - [forum](https://discourse.vvvv.org/t/asyncloop-missing-input-bangs/22071)
- Fixes nodes not turning pink when their exception triggered inside a reactive foreach from within an Update call
- Various `IVLTypeInfo` related fixes
- Fixes misleading / hard to grasp error message when duplicating an output pin
- Fixes warning that there're errors deeper inside not propagating all the way up
- Fixes assembly load error when package was providing runtime assembly in `runtimes/win/lib` (like for example in `System.Management.Automation`)
- Fixes vvvv not starting after double click on vl file in explorer - [forum](https://discourse.vvvv.org/t/double-clicking-a-vl-file-in-windows-explorer/21226)
- Fixes implicit state pin renaming not working for nested patches
- Fixes settings icon not adjusting to light theme
- Fixes tooltip rendering a "ticking clock" on certain observables while in truth they were only pushing one value

## Stride
- Update to Stride 4.2
- TextureFX RGBA inputs are now of type ComputeColor
- Outsources TextureFX into its own package

## ImGui
- Update to 1.90
- Item state gets captured for TreeNode and CollapsingHeader so subsequent query nodes return the correct result - [forum](https://discourse.vvvv.org/t/imgui-isitemhovered-in-nested-treenodes/21608), [forum](https://discourse.vvvv.org/t/the-bug-in-collapsingheader-and-treenode-imgui/21738/2)
- `MenuItem` got `Selected Channel` input pin.
- Adds new pin to `LayerWidget` which gives more control over what events are allowed to pass through
- Fixes init order in generated target code of ImGui region - [forum](https://discourse.vvvv.org/t/having-something-assigned-to-create-in-an-imgui-region-throws-exception/22160/2)
  
## Changes
* Changing values in pins and pads no longer needs a compile step.
* Whether or not a state output pin is visible by default was slightly changed: the pin is always visible except for get/split operations on records.
* All pins (hidden and optional) of a node are now stored in the model. This allows library developers to hide certain pins but still use them to store data. For example the `Bounds` input on newly created `Renderer` is now hidden by default.
* Use `false` as default value for forced apply pins (`Set`/`Reset`/etc.) but not `Update`. Such fragments with forced apply pins are now placed on `Update`. This fixes a very long readability and usability issue with nodes like `LFO` or `Counter` which were showing `true` on pins like `Reset`.
* The node replace command renames pins in case there is a simple solution. For example replacing a property getter with another one will no longer lead to a red pin with the message "Pin X does not exist on Y".
* Gets rid of magic pin renamings on pin creation. Basically let the compiler figure out whether or not a pin is valid / should have an error that it already exists.
* Newly created pins & slots from a rename action will copy over metadata (like type, value, attributes) from original.
* Our dark theme will also make the window title bars dark (works only in Windows >= 10).
* `VL.Video` (former `VL.Video.MediaFoundation`) has been reworked:
  * The package has no more dependencies on `Stride`, `Skia` or `SharpDX`. This reduces the size of exported applications.
  * All backend specific node duplications have been removed. For example `VideoPlayer (Skia)`, `VideoPlayer (Stride)` are no more, instead we only have `VideoPlayer`.
  * The `VideoPlayer` and `VideoIn` nodes return a `IVideoSource` on their main output. That pin can be connected to `VideoSourceToSKImage` (found within `VL.Skia`) or `VideoSourceToTexture` (found within `VL.Stride`). Both of these nodes take care of efficiently turning the received video frames into their respective image type.
  * The before mentioned nodes were introduced earlier this year, but didn't get much attention yet as they were only usable in [VL.IO.NDI](https://github.com/vvvv/VL.IO.NDI). With this release, their functionality has been enhanced so that they can transport the used graphics device upstream. That allows the source (for example the `VideoPlayer`) to enter faster code paths if possible. The produced video frames can be backed by textures and used for rendering directly - no unnecessary memory copies, or GPU download & uploads.
  * Whether or not the graphics device gets communicated to the video source can be controlled via a pin which defaults to true. The video sink nodes further allow to pull the video frames from upstream, that could be useful in scenarios where one wants to synchronize the update rate to the video source.
  * The `MediaFoundation` part has been dropped in the package name to lay the groundwork for more platform neutral work.
* New serialization options
  * Thanks to https://github.com/vvvv/VL.StandardLibs/pull/664 we can now serialize from/to [MessagePack](https://msgpack.org/index.html). The new nodes can be found in the pre-installed package `VL.Serialization.MessagePack`.
  * The previous PR also brought in some plain & simple binary serialization - these nodes can be accessed via the new `VL.Serialization.Raw` package. Note that you should no what a blittable type is or you'll not be happy with them.
  * To make thing symetric we moved the [FSPickler](https://mbraceproject.github.io/FsPickler/) based nodes to the new `VL.Serialization.FSPickler` package. A converter will take care of fixing your existing patches.
* Our serializer supports the [`NonSerializedAttribute`](https://learn.microsoft.com/en-us/dotnet/api/system.nonserializedattribute?view=net-7.0)
* Fixes extremely bad performance in our serializer
* Patched objects use the VL type name for their string rendering. For example calling `ToString` on a `Person` class will result in "Person" and not some compiler generated mangled name.
* Direct import of types & nodes from C#
  * It's now possible to write types & nodes directly from within C# with the new [`ImportAsIs`](https://github.com/vvvv/VL.StandardLibs/blob/main/VL.Core/src/Import/ImportAsIsAttribute.cs) assembly attribute. When set, all the public classes / structs / enums will be available in VL as if they'd have been defined there directly. No type forwarding required.
  * It's further possible to write process nodes directly in C# by attaching the new [`ProcessNode`](https://github.com/vvvv/VL.StandardLibs/blob/main/VL.Core/src/Import/ProcessNodeAttribute.cs) on a class. Again, no further work has to be done on the VL side of thins.
  * This way (if desired) the C# code can be become the single source of truth for a library project.
* `Skia`
  * `InjectNotifications` allows creating custom Mouse/Keyboard
* More fine grained control over what types are allowed over a `T -> M<T>` connection via new `IMonadicTypeFilter` interface (used by [FUSE](https://www.thefuselab.io/))
